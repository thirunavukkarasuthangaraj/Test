import { Router, ActivatedRoute } from '@angular/router';
import { AfterViewInit, ChangeDetectorRef, Component, Input, OnInit } from '@angular/core';
import { ApiService } from 'src/app/services/api.service';
import { AppSettings } from 'src/app/services/AppSettings';

@Component({
  selector: 'app-common-profile-info',
  templateUrl: './common-profile-info.component.html',
  styleUrls: ['./common-profile-info.component.scss']
})
export class CommonProfileInfoComponent implements OnInit, AfterViewInit {

  @Input('type') type: any;
  @Input() userIdInput: String;
  @Input() page: String;
  @Input('src') srcImg: any;
  userinfo: any = []
  @Input('data') data: any;

  img: any = 'assets/images/userAvatar.png';

  constructor(private cdRef: ChangeDetectorRef, private auth: ApiService, private router: Router) {
    if (this.type && this.type === 'HASHTAG') {
      this.img = 'assets/images/hashtag.png';
    } else if (this.type && this.type === 'BUSINESS') {
      this.img = 'assets/images/gallery/company.png';
    }
  }

  ngOnInit() {
    this.userprofile();
  }



  userprofile() {

    if(this.userIdInput!=undefined){
      this.auth.query("user/" + this.userIdInput).subscribe(userres => {
        ////// console.log('userres',userres)
        if(this.page == "BUSINESS"){
        // alert(JSON.stringify(this.data));
          if(this.data.businessLogo!=undefined && this.data.businessLogo!=null){
            this.img = AppSettings.photoUrl + this.data.businessLogo;
          }else{
            this.img="assets/images/gallery/company.png"
          }
          this.userinfo = userres;
        } else if(this.page == "COMMUNITY"){
          if(this.data.communityLogo!=undefined && this.data.communityLogo!=null){
            this.img = AppSettings.photoUrl + this.data.communityLogo;
          }else{
            this.img="assets/icon/comm.png"
          }
          this.userinfo = userres;
        }else {
          this.img = AppSettings.photoUrl + userres.photo;
          this.userinfo = userres;
        }


      },err => {
        this.auth.stopLoader();
       });
    }


  }

  route(data) {


    if (this.type == "BUSINESS") {

      if (this.data != undefined && this.data != null && this.data != "") {
          this.router.navigate(['business'], { queryParams: this.data, replaceUrl: true });
       }

    } else if (this.type == "COMMUNITY") {
       setTimeout(() => {
        this.router.navigate(['community'], { queryParams: this.data, replaceUrl: true });
      }, 80);

      } else {
        let userId = data.userId;
         setTimeout(() => {
           if(data.userId!=""){
            this.router.navigate(['personalProfile'], { queryParams: {"userId":userId}, replaceUrl: true });
           }
        }, 80);

    }

  }


  ngAfterViewInit() {
    if (this.type && this.type === 'HASHTAG') {
      this.img = 'assets/images/hashtag.png';
    } else if (this.type && this.type === 'BUSINESS') {
      this.img = 'assets/images/gallery/company.png';
    }

    this.cdRef.detectChanges();
  }


  datapass(data) {
  }
}
