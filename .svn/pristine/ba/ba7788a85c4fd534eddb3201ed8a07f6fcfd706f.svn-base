import { HttpClient } from '@angular/common/http';
import { Component, OnInit } from '@angular/core';
import { ApiService } from 'src/app/services/api.service';
import { FormBuilder, FormControl } from '@angular/forms';
import { Router, ActivatedRoute } from '@angular/router';
import { AppSettings } from 'src/app/services/AppSettings';
import { UtilService } from 'src/app/services/util.service';

@Component({
  selector: 'app-communities',
  templateUrl: './communities.component.html',
  styleUrls: ['./communities.component.scss']
})
export class CommunitiesComponent implements OnInit {

  items;
  term;
  commData;
  data;
  srarch;

  commShow=true;
  commShow1=false;

  constructor(
    private API: ApiService,
    private fb: FormBuilder,
    private router: Router ,
    private route: ActivatedRoute,
    private http: HttpClient,
    private util: UtilService
  ) { }

  ngOnInit() {
    this.route.queryParams.subscribe((res) => {
      ////// console.log('res data', res.data)
      this.data=res.data
      this.srarch = res.searchData;
      this.clearInput.patchValue(this.srarch);
      if(this.data != 'undefined' && this.srarch != 'undefined'){

      this.dataCommunity();
      }else{
        this.communityUserData();
      }
     });

  }


  communityUserData(){

    const data = {'search': this.srarch,
    // 'searchContent':'ALL',
    'searchContent':  'COMMUNITY',
    'loginUserId':localStorage.getItem('userId'),
    'page': {
            'offSet': 0,
            'pageCount': 5,
            }
    };
 this.util.startLoader()
    this.API.create('home/profiles/searchAll' , data).subscribe(resdata =>{
      this.util.stopLoader()
      this.commData = resdata.communityPages;
      ////// console.log('comm data :.....',this.commData);

      this.commData.forEach(element => {
        element.commLog = AppSettings.photoUrl + element.banner;
       });

       ////// console.log(this.commData)
      },err => {
        this.util.stopLoader(); 
         
       });
  
  }

  dataCommunity(){
    const data = {'search': this.srarch,
    // 'searchContent':'ALL',
    'searchContent':  'COMMUNITY',
    'loginUserId':localStorage.getItem('userId'),
    'page': {
            'offSet': 0,
            'pageCount': 5,
            }
    };
this.util.startLoader()
    this.API.create('home/profiles/searchAll' , data).subscribe(resdata =>{
      this.util.stopLoader()
      this.commData = resdata.communityPages;
      ////// console.log('comm data :.....',this.commData);

      this.commData.forEach(element => {
        element.commLog = AppSettings.photoUrl + element.banner;
       });

       ////// console.log(this.commData)
      },err => {
        this.util.stopLoader(); 
         
       });
  
  }
  communityLink(dataLink){
    ////// console.log('communityLink(dataLink) :.....',dataLink)
    var data : any = {};
    data.communityId = dataLink.communityId;
    this.router.navigate(['community'],{queryParams : data})
  }

  clearInput = new FormControl();

  clearData(){
    this.clearInput.reset();
  ////// console.log('cleare Data')
  }


  community(comm){
    this.commShow = false;
    this.commShow1 = true;
    const data = {'search': this.clearInput.value,
    // 'searchContent':'ALL',
    'searchContent':  'COMMUNITY',
    'loginUserId':localStorage.getItem('userId'),
    'page': {
            'offSet': 0,
            'pageCount': 5,
            }
    };
this.util.startLoader()
    this.API.create('home/profiles/searchAll' , data).subscribe(resdata =>{
      this.util.stopLoader()
      this.commData = resdata.communityPages;
      ////// console.log('comm data :.....',this.commData);

      this.commData.forEach(element => {
        element.commLog = AppSettings.photoUrl + element.banner;
       });

       ////// console.log(this.commData)
      },err => {
        this.util.stopLoader(); 
         
       });
  
  }
}
