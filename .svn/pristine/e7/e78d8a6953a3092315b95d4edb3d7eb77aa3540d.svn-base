import { Component, OnInit } from "@angular/core";
import { ActivatedRoute, Router } from "@angular/router";
import { url } from "inspector";
import { CookieService } from "ngx-cookie-service";
import { ApiService } from "src/app/services/api.service";
import { AppSettings } from "src/app/services/AppSettings";
import { UtilService } from "src/app/services/util.service";
import { environment } from "src/environments/environment";

@Component({
  selector: "app-busines-directory-profile",
  templateUrl: "./busines-directory-profile.component.html",
  styleUrls: ["./busines-directory-profile.component.scss"],
})
export class BusinesDirectoryProfileComponent implements OnInit {
  data: any;
  similarorganization: any;
  organizationId;
  indexcount: number = 5;
  constructor(
    private aroute: ActivatedRoute,
    private router: Router,
    private util: UtilService,
    private api: ApiService,
    private _cookie: CookieService
  ) {
    this.aroute.params.subscribe((res) => {
      this.organizationId = res.organizationId;
    });
  }

  ngOnInit() {
    this.getprofileData();
    this.getsimilarorganizationData();
  }

  redirectTo(value) {
    if (value == "claimBusiness") {
      const sessionId = this._cookie.get("sessionID");
      if (sessionId && sessionId !== null && sessionId !== "") {
        // console.log("passing through this");
        // var userId = localStorage.getItem("userId");
        // window.location.href =
        //   environment.careOnlineWebUrl +
        //   "createBusiness" +
        //   "?orgId=" +
        //   this.organizationId +
        //   "&businessName=" +
        //   this.data.organizationName +
        //   "&zipCode=" +
        //   this.data.mailingAddress.postalCode +
        //   "&city=" +
        //   this.data.mailingAddress.city +
        //   "&state=" +
        //   this.data.mailingAddress.state +
        //   "&country=" +
        //   this.data.mailingAddress.country +
        //   "&street=" +
        //   this.data.mailingAddress.street +
        //   localStorage.setItem("organizationId", this.organizationId);
        this._cookie.deleteAll();
        window.location.href = environment.careOnlineWebUrl + "login";
      } else {
        window.location.href =
          environment.careOnlineWebUrl +
          "signUp" +
          "?businessProfileId=" +
          this.organizationId +
          "&source=businessOrganizationDirectory"
          // "&firstName=" +
          // this.data.authorizedOfficialFirstName +
          // "&lastName=" +
          // this.data.authorizedOfficialLastName;
      }

      // businessProfileId=26921474798970233261507&source=businessOrganizationDirectory&firstName=Margaret&lastName=Pemberton
    } else if (value == "login") {
      window.location.href = environment.careOnlineWebUrl;
    } else if (value == "signUp") {
      window.location.href = environment.careOnlineWebUrl + value;
    }
  }

  route(id) {
    this.organizationId = id;
    this.getprofileData();
    this.getsimilarorganizationData();
  }

  viewmore() {
    this.indexcount = 100;
  }

  img = {
    src: null,
  };

  getprofileData() {
    this.util.startLoader();
    this.api
      .query("healthcare/hcp/organization/" + this.organizationId)
      .subscribe((res) => {
        this.util.stopLoader();
        if (res != null) {
          if (res.code == "00000") {
            if (
              res.data.hcporganization != null &&
              res.data.hcporganization != undefined
            ) {
              this.data = res.data.hcporganization;
            }
            if (this.data.businessLogo != null) {
              this.img = {
                src:
                  AppSettings.ServerUrl + "download/" + this.data.businessLogo,
              };
            }
          }
        }
      },err => {
        this.util.stopLoader(); 
      });
  }
  getsimilarorganizationData() {
    this.api
      .query("healthcare/hcp/similar/org/" + this.organizationId)
      .subscribe((res) => {
        if (res != null) {
          if (res.code == "00000") {
            if (
              res.data.similarorganization != null &&
              res.data.similarorganization != undefined
            ) {
              this.similarorganization = res.data.similarorganization;
            }
          }
        }
      },err => {
        this.util.stopLoader(); 
      });
  }
}
